<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cosmic Runner</title>
<style>
  body { margin:0; overflow:hidden; background:black; font-family: sans-serif; color:white; }
  #score { position:absolute; top:20px; left:20px; font-size:24px; z-index:100; }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.z = 50;

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Starfield
let starCount = 2000;
let starGeometry = new THREE.BufferGeometry();
let starPositions = [];
for(let i=0;i<starCount;i++){
    starPositions.push((Math.random()-0.5)*2000, (Math.random()-0.5)*2000, (Math.random()-0.5)*2000);
}
starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starPositions,3));
let starMaterial = new THREE.PointsMaterial({color:0xffffff, size:0.8});
let stars = new THREE.Points(starGeometry, starMaterial);
scene.add(stars);

// Wormhole tube
let wormholeGeometry = new THREE.CylinderGeometry(20,0,400,64,1,true);
let wormholeMaterial = new THREE.MeshBasicMaterial({color:0x33ccff, wireframe:true, opacity:0.15, transparent:true});
let wormhole = new THREE.Mesh(wormholeGeometry, wormholeMaterial);
wormhole.rotation.x = Math.PI/2;
scene.add(wormhole);

// Player spaceship
let shipGeometry = new THREE.ConeGeometry(1.5,4,8);
let shipMaterial = new THREE.MeshBasicMaterial({color:0xff3333});
let ship = new THREE.Mesh(shipGeometry, shipMaterial);
ship.rotation.x = Math.PI/2;
ship.position.z = 0;
scene.add(ship);

// Stars to collect
let collectables = [];
function spawnStar(){
    let geo = new THREE.SphereGeometry(0.5,8,8);
    let mat = new THREE.MeshBasicMaterial({color:0xffff33});
    let star = new THREE.Mesh(geo, mat);
    star.position.set((Math.random()-0.5)*30, (Math.random()-0.5)*30, -200);
    scene.add(star);
    collectables.push(star);
}
for(let i=0;i<10;i++) spawnStar();

// Obstacles
let obstacles = [];
function spawnObstacle(){
    let geo = new THREE.BoxGeometry(3,3,3);
    let mat = new THREE.MeshBasicMaterial({color:0x33ff33});
    let obs = new THREE.Mesh(geo, mat);
    obs.position.set((Math.random()-0.5)*30, (Math.random()-0.5)*30, -200);
    scene.add(obs);
    obstacles.push(obs);
}
for(let i=0;i<5;i++) spawnObstacle();

// Controls
let keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

let score = 0;

// Game loop
function animate(){
    requestAnimationFrame(animate);

    // Move spaceship
    if(keys['arrowleft']) ship.position.x -= 0.8;
    if(keys['arrowright']) ship.position.x += 0.8;
    if(keys['arrowup']) ship.position.y += 0.8;
    if(keys['arrowdown']) ship.position.y -= 0.8;

    // Move stars forward
    collectables.forEach((star, i)=>{
        star.position.z += 1.5;
        if(star.position.z > 5){
            star.position.z = -200;
            star.position.x = (Math.random()-0.5)*30;
            star.position.y = (Math.random()-0.5)*30;
        }
        // Collision
        if(ship.position.distanceTo(star) < 2){
            score += 1;
            document.getElementById('score').innerText = 'Score: ' + score;
            star.position.z = -200;
            star.position.x = (Math.random()-0.5)*30;
            star.position.y = (Math.random()-0.5)*30;
        }
    });

    // Move obstacles forward
    obstacles.forEach((obs, i)=>{
        obs.position.z += 1.5;
        if(obs.position.z > 5){
            obs.position.z = -200;
            obs.position.x = (Math.random()-0.5)*30;
            obs.position.y = (Math.random()-0.5)*30;
        }
        // Collision
        if(ship.position.distanceTo(obs) < 2){
            alert("Game Over! Final Score: " + score);
            location.reload();
        }
    });

    // Rotate wormhole & stars
    stars.rotation.y += 0.005;
    stars.rotation.x += 0.002;
    wormhole.rotation.z += 0.01;

    // Camera follows ship slightly
    camera.position.x += (ship.position.x - camera.position.x) * 0.05;
    camera.position.y += (ship.position.y - camera.position.y) * 0.05;
    camera.lookAt(scene.position);

    renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
