<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legend of Pixel Adventure</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
    margin:0;
    padding:0;
    overflow:hidden;
    background:#000;
    font-family: monospace;
}
canvas { display:block; margin:0; background:#000; }
#ui{
    position:fixed;
    top:10px;
    left:10px;
    color:#0ff;
    font-size:18px;
    z-index:10;
}
#message{
    position:fixed;
    bottom:10px;
    left:50%;
    transform:translateX(-50%);
    color:#ff0;
    font-size:16px;
    z-index:10;
}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui">Health: <span id="health">5</span> | Keys: <span id="keys">0</span> | Score: <span id="score">0</span></div>
<div id="message"></div>
<script>
// --- Setup ---
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;
window.addEventListener('resize',()=>{ width=canvas.width=window.innerWidth; height=canvas.height=window.innerHeight; });

// --- Tile Map ---
const TILE = 32;
const ROOM_WIDTH = 16;
const ROOM_HEIGHT = 12;

// Define rooms: 0=empty, 1=wall, 2=enemy, 3=key, 4=door
const rooms = [
    [   // Room 0
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,1],
        [1,0,2,0,0,2,0,0,2,0,0,2,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,2,0,0,2,0,0,2,0,0,2,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,2,0,0,2,0,0,2,0,0,2,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,1],
        [1,0,0,2,0,0,2,0,0,2,0,0,2,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,2,0,0,2,0,0,2,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    ],
    [   // Room 1
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1],
        [1,0,2,0,0,2,0,0,2,0,0,2,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,1],
        [1,0,2,0,0,2,0,0,2,0,0,2,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,2,0,0,2,0,0,2,0,0,2,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,1],
        [1,0,2,0,0,2,0,0,2,0,0,2,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    ]
];

// --- Player ---
const player = {x:2*TILE,y:2*TILE,w:28,h:28,health:5,keys:0,speed:2,dir:'down',swing:false};

// --- Input ---
const keysDown = {};
window.addEventListener('keydown', e=>{ keysDown[e.key]=true; });
window.addEventListener('keyup', e=>{ keysDown[e.key]=false; });

// --- Game State ---
let roomIndex=0;
let enemies=[];

// --- Sound Effects ---
function playSound(type){
    const ctxAudio = new (window.AudioContext||window.webkitAudioContext)();
    const osc = ctxAudio.createOscillator();
    osc.type = "square";
    osc.frequency.setValueAtTime(type==="swing"?600: type==="hit"?200:400, ctxAudio.currentTime);
    osc.connect(ctxAudio.destination);
    osc.start();
    osc.stop(ctxAudio.currentTime + 0.1);
}

// --- Utility ---
function drawRect(x,y,w,h,color){ ctx.fillStyle=color; ctx.fillRect(x,y,w,h); }

// --- Load Enemies ---
function loadEnemies(){
    enemies=[];
    const map = rooms[roomIndex];
    for(let y=0;y<ROOM_HEIGHT;y++){
        for(let x=0;x<ROOM_WIDTH;x++){
            if(map[y][x]===2) enemies.push({x:x*TILE,y:y*TILE,w:28,h:28,dir:Math.random()<0.5?1:-1});
        }
    }
}

// --- Init ---
loadEnemies();

// --- Game Loop ---
function update(){
    // Movement
    if(keysDown['ArrowUp']) player.y -= player.speed,player.dir='up';
    if(keysDown['ArrowDown']) player.y += player.speed,player.dir='down';
    if(keysDown['ArrowLeft']) player.x -= player.speed,player.dir='left';
    if(keysDown['ArrowRight']) player.x += player.speed,player.dir='right';
    if(keysDown[' ']) player.swing=true,playSound('swing'); else player.swing=false;

    // Collision with walls
    const map = rooms[roomIndex];
    for(let y=0;y<ROOM_HEIGHT;y++){
        for(let x=0;x<ROOM_WIDTH;x++){
            if(map[y][x]===1){
                const wx = x*TILE, wy=y*TILE;
                if(player.x+player.w>wx && player.x<wx+TILE && player.y+player.h>wy && player.y<wy+TILE){
                    if(keysDown['ArrowUp']) player.y+=player.speed;
                    if(keysDown['ArrowDown']) player.y-=player.speed;
                    if(keysDown['ArrowLeft']) player.x+=player.speed;
                    if(keysDown['ArrowRight']) player.x-=player.speed;
                }
            }
        }
    }

    // Enemy movement simple AI
    enemies.forEach(e=>{
        e.y+=0.5*e.dir;
        if(e.y<0 || e.y+e.h>ROOM_HEIGHT*TILE) e.dir*=-1;
    });

    // Sword attack collision
    if(player.swing){
        enemies.forEach((e,i)=>{
            const sx = player.x+(player.dir==='right'?player.w:player.dir==='left'?-player.w:0);
            const sy = player.y+(player.dir==='down'?player.h:player.dir==='up'?-player.h:0);
            if(sx<e.x+e.w && sx+player.w>e.x && sy<e.y+e.h && sy+player.h>e.y){
                enemies.splice(i,1); score++; document.getElementById('score').textContent=score; playSound('hit');
            }
        });
    }

    // Enemy touching player
    enemies.forEach(e=>{
        if(player.x<e.x+e.w && player.x+player.w>e.x && player.y<e.y+e.h && player.y+player.h>e.y){
            player.health--; document.getElementById('health').textContent=player.health; playSound('hit');
            if(player.health<=0){ alert("Game Over! Score:"+score); location.reload(); }
        }
    });

    // Collect key or door
    for(let y=0;y<ROOM_HEIGHT;y++){
        for(let x=0;x<ROOM_WIDTH;x++){
            if(map[y][x]===3 && player.x<TILE*x+TILE && player.x+player.w>TILE*x && player.y<TILE*y+TILE && player.y+player.h>TILE*y){
                player.keys++; map[y][x]=0; document.getElementById('keys').textContent=player.keys;
            }
            if(map[y][x]===4 && player.keys>0 && player.x<TILE*x+TILE && player.x+player.w>TILE*x && player.y<TILE*y+TILE && player.y+player.h>TILE*y){
                player.keys--; map[y][x]=0; document.getElementById('keys').textContent=player.keys;
                roomIndex = (roomIndex+1)%rooms.length; loadEnemies();
            }
        }
    }
}

// --- Draw ---
function draw(){
    ctx.clearRect(0,0,width,height);
    const map = rooms[roomIndex];
    for(let y=0;y<ROOM_HEIGHT;y++){
        for(let x=0;x<ROOM_WIDTH;x++){
            if(map[y][x]===1) drawRect(x*TILE,y*TILE,TILE,TILE,'#555');
            if(map[y][x]===3) drawRect(x*TILE+8,y*TILE+8,TILE-16,TILE-16,'#ff0');
            if(map[y][x]===4) drawRect(x*TILE,y*TILE,TILE,TILE,'#0f0');
        }
    }

    // Enemies
    enemies.forEach(e=>drawRect(e.x,e.y,e.w,e.h,'#f00'));

    // Player
    drawRect(player.x,player.y,player.w,player.h,'#0ff');

    // Sword swing
    if(player.swing){
        if(player.dir==='up') drawRect(player.x,player.y-16,player.w,16,'#ff0');
        if(player.dir==='down') drawRect(player.x,player.y+player.h,player.w,16,'#ff0');
        if(player.dir==='left') drawRect(player.x-16,player.y,16,player.h,'#ff0');
        if(player.dir==='right') drawRect(player.x+player.w,player.y,16,player.h,'#ff0');
    }
}

// --- Main Loop ---
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>